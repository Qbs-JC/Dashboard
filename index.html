<!DOCTYPE html>
<html lang="de">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Company Live & History Dashboard</title>
Â  Â Â 
Â  Â  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; margin: 0; display: flex; flex-direction: column; align-items: center; }
Â  Â  Â  Â  header { background: white; width: 100%; padding: 20px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; width: 90%; max-width: 1000px; margin-top: 30px; }
Â  Â  Â  Â  .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); text-align: center; position: relative; }
Â  Â  Â  Â  .label { color: #666; font-size: 0.8em; text-transform: uppercase; }
Â  Â  Â  Â  .value { font-size: 2.5em; font-weight: bold; margin: 10px 0; color: #333; }
Â  Â  Â  Â  .unit { font-size: 0.4em; color: #999; margin-left: 5px; }
Â  Â  Â  Â  .source-tag { position: absolute; bottom: 5px; right: 10px; font-size: 0.6em; color: #ccc; }
Â  Â  Â  Â  #status { font-weight: bold; margin-top: 10px; transition: color 0.3s; }
Â  Â  Â  Â  .error-box { background: #ffcdd2; color: #b71c1c; padding: 15px; border-radius: 8px; margin: 20px; display: none; width: 80%; }
Â  Â  </style>
</head>
<body>

<header>
Â  Â  <h1>Company IoT Monitor</h1>
Â  Â  <div id="status" style="color: #e67e22;">â³ Initialisierung...</div>
</header>

<div id="error-display" class="error-box"></div>

<div class="container">
Â  Â  <div class="card">
Â  Â  Â  Â  <div class="label">Temperatur</div>
Â  Â  Â  Â  <div class="value" style="color: #ff5722;"><span id="temp">--.-</span><span class="unit">Â°C</span></div>
Â  Â  Â  Â  <div class="source-tag" id="temp-source">Keine Daten</div>
Â  Â  </div>
Â  Â  <div class="card">
Â  Â  Â  Â  <div class="label">Feuchtigkeit</div>
Â  Â  Â  Â  <div class="value" style="color: #2196f3;"><span id="hum">--</span><span class="unit">%</span></div>
Â  Â  Â  Â  <div class="source-tag" id="hum-source">Keine Daten</div>
Â  Â  </div>
Â  Â  <div class="card">
Â  Â  Â  Â  <div class="label">CO2</div>
Â  Â  Â  Â  <div class="value" style="color: #4caf50;"><span id="co2">----</span><span class="unit">ppm</span></div>
Â  Â  Â  Â  <div class="source-tag" id="co2-source">Keine Daten</div>
Â  Â  </div>
Â  Â  <div class="card">
Â  Â  Â  Â  <div class="label">TVOC</div>
Â  Â  Â  Â  <div class="value" style="color: #9c27b0;"><span id="tvoc">----</span><span class="unit">ppb</span></div>
Â  Â  Â  Â  <div class="source-tag" id="tvoc-source">Keine Daten</div>
Â  Â  </div>
</div>

<script>
Â  Â  // --- 1. KONFIGURATION (HIER DEINE DATEN EINTRAGEN) ---
Â  Â  const CONFIG = {
Â  Â  Â  Â  supabaseUrl: 'https://rrdbrezbsttlkzeaudch.supabase.co',
Â  Â  Â  Â  supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyZGJyZXpic3R0bGt6ZWF1ZGNoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0Mzc1OTAsImV4cCI6MjA4NzAxMzU5MH0.YzkCMSTOggB0fH0Wf6jLgw5Qb4nJM5IjfUQKbIsb-Bc',
Â  Â  Â  Â  dbTable: 'wetterdaten',
Â  Â  Â  Â  dbMacColumn: 'device_id', // Name der Spalte fÃ¼r die MAC-Adresse
Â  Â  Â  Â  mqttBroker: 'wss://g306b096.ala.eu-central-1.emqxsl.com:8084/mqtt',
Â  Â  Â  Â  mqttUser: 'web_user',
Â  Â  Â  Â  mqttPass: 'web_password123'
Â  Â  };

Â  Â  // 2. ID aus URL extrahieren
Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  const deviceId = urlParams.get('id');

Â  Â  // Supabase Initialisierung
Â  Â  const supabase = supabasejs.createClient(CONFIG.supabaseUrl, CONFIG.supabaseKey);

Â  Â  // Hilfsfunktion zum UI-Update
Â  Â  function updateDisplay(data, source) {
Â  Â  Â  Â  const fields = ['temp', 'hum', 'co2', 'tvoc'];
Â  Â  Â  Â  fields.forEach(field => {
Â  Â  Â  Â  Â  Â  if (data[field] !== undefined) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(field).innerText = data[field];
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById(`${field}-source`).innerText = source;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // 3. DATEN AUS DATENBANK LADEN (History)
Â  Â  async function fetchDatabaseHistory() {
Â  Â  Â  Â  if (!deviceId) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const { data, error } = await supabase
Â  Â  Â  Â  Â  Â  .from(CONFIG.dbTable)
Â  Â  Â  Â  Â  Â  .select('*')
Â  Â  Â  Â  Â  Â  .eq(CONFIG.dbMacColumn, deviceId)
Â  Â  Â  Â  Â  Â  .order('created_at', { ascending: false })
Â  Â  Â  Â  Â  Â  .limit(1);

Â  Â  Â  Â  if (error) {
Â  Â  Â  Â  Â  Â  console.error("DB-Fehler:", error);
Â  Â  Â  Â  } else if (data && data.length > 0) {
Â  Â  Â  Â  Â  Â  updateDisplay(data[0], "Datenbank (Historie)");
Â  Â  Â  Â  Â  Â  document.getElementById('status').innerText = "ğŸ“Š Letzte DB-Werte geladen...";
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // 4. MQTT LIVE VERBINDUNG
Â  Â  function startMqttLive() {
Â  Â  Â  Â  if (!deviceId) {
Â  Â  Â  Â  Â  Â  document.getElementById('error-display').style.display = 'block';
Â  Â  Â  Â  Â  Â  document.getElementById('error-display').innerText = "âš ï¸ Fehler: Keine GerÃ¤te-ID in der URL (?id=...) gefunden.";
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const topic = `esp32-${deviceId}/sensor`;
Â  Â  Â  Â  const client = mqtt.connect(CONFIG.mqttBroker, {
Â  Â  Â  Â  Â  Â  username: CONFIG.mqttUser,
Â  Â  Â  Â  Â  Â  password: CONFIG.mqttPass
Â  Â  Â  Â  });

Â  Â  Â  Â  client.on('connect', () => {
Â  Â  Â  Â  Â  Â  document.getElementById('status').innerText = `ğŸŸ¢ LIVE - GerÃ¤t: ${deviceId}`;
Â  Â  Â  Â  Â  Â  document.getElementById('status').style.color = "green";
Â  Â  Â  Â  Â  Â  client.subscribe(topic);
Â  Â  Â  Â  });

Â  Â  Â  Â  client.on('message', (t, message) => {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const liveData = JSON.parse(message.toString());
Â  Â  Â  Â  Â  Â  Â  Â  updateDisplay(liveData, "Live (MQTT)");
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("JSON Fehler:", e);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  client.on('error', () => {
Â  Â  Â  Â  Â  Â  document.getElementById('status').innerText = "ğŸ”´ MQTT Verbindungsfehler";
Â  Â  Â  Â  Â  Â  document.getElementById('status').style.color = "red";
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Start-Reihenfolge
Â  Â  if (deviceId) {
Â  Â  Â  Â  fetchDatabaseHistory().then(startMqttLive);
Â  Â  } else {
Â  Â  Â  Â  document.getElementById('status').innerText = "ğŸ”´ ID fehlt";
Â  Â  }

</script>
</body>
</html>


dies ist meine index.html passt diese?
